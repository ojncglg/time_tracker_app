<!DOCTYPE html>
<!--
  Template: landing.html
  Purpose: Dashboard landing page for all authenticated users.
  Data contract:
    - user (dict-like): contains rank, last_name, call_sign, squad.
    - session.role: string indicating current session role ("user", "admin", "webmaster").
  Notes:
    - Unified toasts partial is included at the top.
    - Navigation is role-aware: admin-only links rendered only if role ‚àà {admin, webmaster}.
    - Uses Tailwind CSS and local style.css.
-->
<html lang="en">
  <head>
    <!-- Basic meta tags for encoding & viewport -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <!-- Tailwind via CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Local stylesheet for shared components & dark mode -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>

  <body class="theme-dark min-h-screen">
    <!--
      Dark theme baseline;
      body stretches full viewport height
    -->
    <!-- Main container -->
    <div class="max-w-5xl mx-auto px-4 py-12 animate-fade-in">
      <!-- Toast notifications for feedback (success/error/info) -->
      {# Unified toasts #} {% include '_toasts.html' %}

      <!-- Greeting: personalized welcome using user context -->
      <!-- Greeting -->
      <header class="text-center mb-8">
        <h2 class="text-4xl font-bold tracking-tight">
          Welcome {{ user.rank }} {{ user.last_name }}
        </h2>
        <p class="mt-2 text-sm muted">Stay organized. Quick actions below.</p>
      </header>

      <!-- Key attributes section: show user call sign and squad -->
      <!-- Key attributes -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 text-center">
        <div class="card card--loose">
          <p class="text-sm muted">Call Sign</p>
          <p class="text-2xl font-semibold" style="color: var(--gold)">
            {{ user.call_sign }}
          </p>
        </div>
        <div class="card card--loose">
          <p class="text-sm muted">Squad</p>
          <p class="text-2xl font-semibold" style="color: var(--gold)">
            {{ user.squad }}
          </p>
        </div>
      </div>

      <!-- Primary navigation cards for main user actions -->
      <!-- Main navigation cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Nav-card: Submit vacation/sick request -->
        <!-- Request time off -->
        <a
          href="{{ url_for('request_time_off') }}"
          class="nav-card no-underline"
        >
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">Request Time Off</h3>
              <p class="nav-card__meta muted">
                Submit a vacation or sick leave request.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üèù</span>
          </div>
        </a>

        <!-- Nav-card: View squad monthly shift calendar -->
        <!-- View calendar -->
        <a href="{{ url_for('calendar_view') }}" class="nav-card no-underline">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">View Calendar</h3>
              <p class="nav-card__meta muted">
                See your squad‚Äôs monthly shift assignments.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üìÖ</span>
          </div>
        </a>

        <!-- Nav-card: View balances and request history -->
        <!-- My Requests -->
        <a href="{{ url_for('my_requests') }}" class="nav-card no-underline">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">My Requests</h3>
              <p class="nav-card__meta muted">
                See Vacation/Sick balances (YTD) and request history.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üìã</span>
          </div>
        </a>

        <!-- Admin-only section: gated by session.role -->
        {# Admin-only links (gate by session role) #} {% set role =
        session.get('role') %} {% if role in ['webmaster', 'admin'] %}
        <div class="col-span-full mt-2">
          <div class="admin-banner">ADMINISTRATOR &amp; SUPERVISOR TOOLS</div>
        </div>

        <!-- Nav-card: Admin review pending requests -->
        <!-- Pending Requests -->
        <a href="{{ url_for('admin_requests') }}" class="nav-card no-underline">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">Pending Requests</h3>
              <p class="nav-card__meta muted">
                Approve or deny vacation/sick requests.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üóÇÔ∏è</span>
          </div>
        </a>
        <!-- Nav-card: Admin audit log of handled requests -->
        <!-- Vacation History -->
        <a href="{{ url_for('admin_history') }}" class="nav-card no-underline">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">Vacation History</h3>
              <p class="nav-card__meta muted">
                Audit log of past handled requests.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üìö</span>
          </div>
        </a>
        <!-- Nav-card: Admin open/close vacation bidding -->
        <!-- Vacation Bidding -->
        <a
          href="{{ url_for('vacation_bidding') }}"
          class="nav-card no-underline"
        >
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">Vacation Bidding</h3>
              <p class="nav-card__meta muted">
                Open/close vacation bidding in seniority order.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üóìÔ∏è</span>
          </div>
        </a>
        <!-- Nav-card (form-wrapped): Run NCCPD accrual (carryover + annual entitlement) -->
        <form action="{{ url_for('nccpd_run_accrual') }}" method="POST">
          <input type="hidden" name="_csrf" value="{{ csrf_token() }}" />
          <!-- Link triggers form.submit() with JS confirm prompt -->
          <a
            href="#"
            class="nav-card no-underline"
            onclick="if (confirm('Run NCCPD accrual now? This will recompute balances for the current calendar year.')) { this.closest('form').submit(); } return false;"
          >
            <div class="flex items-start justify-between">
              <div>
                <h3 class="nav-card__title text-lg mb-1">RUN NCCPD ACCRUAL</h3>
                <p class="nav-card__meta muted">
                  Apply carryover/min-use and add annual entitlement.
                </p>
              </div>
              <span class="emoji" aria-hidden="true">‚öôÔ∏è</span>
            </div>
          </a>
        </form>

        <!-- Nav-card: NCCPD Create a Training Day (supervisor/admin/webmaster) -->
        <a
          href="{{ url_for('training_day_create') }}"
          class="nav-card no-underline"
        >
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">
                Create a Training Day (NCCPD)
              </h3>
              <p class="nav-card__meta muted">
                Supervisors can create a Training Day entry. (Placeholder)
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üéì</span>
          </div>
        </a>

        <!-- Nav-card: Supervisor Set Day Status (NCCPD) -->
        <a href="{{ url_for('day_status') }}" class="nav-card no-underline">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">
                Set Day Status (NCCPD)
              </h3>
              <p class="nav-card__meta muted">
                Supervisors can set per-day status for officers (future 30
                days).
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üìù</span>
          </div>
        </a>

        <!-- Nav-card: Admin Tow Log -->
        <a href="{{ url_for('admin_tow_log') }}" class="nav-card no-underline">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">
                Admin Tow Log (NCCPD)
              </h3>
              <p class="nav-card__meta muted">
                Review and manage all submitted tow logs.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üöõ</span>
          </div>
        </a>

        <!-- Nav-card: Admin Tow Log -->
        <a href="{{ url_for('tow_log') }}" class="nav-card no-underline">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">Tow Log (NCCPD)</h3>
              <p class="nav-card__meta muted">
                Review and manage public tow submissions.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üöö</span>
          </div>
        </a>

        <!-- Nav-card: Admin user editor -->
        <!-- Edit Users (matches other nav-card tiles + üë• emoji) -->
        <a
          href="{{ url_for('edit_user', username=session.get('username')) }}"
          class="nav-card no-underline"
        >
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">Edit Users</h3>
              <p class="nav-card__meta muted">
                Open the user editor and choose any officer.
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üë•</span>
          </div>
        </a>
        {% elif role == 'supervisor' %}
        <div class="col-span-full mt-2">
          <div class="admin-banner">SUPERVISOR TOOLS</div>
        </div>

        <!-- Nav-card: NCCPD Create a Training Day (supervisor only) -->
        <a
          href="{{ url_for('training_day_create') }}"
          class="nav-card no-underline"
        >
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">
                Create a Training Day (NCCPD)
              </h3>
              <p class="nav-card__meta muted">
                Supervisors can create a Training Day entry. (Placeholder)
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üéì</span>
          </div>
        </a>

        <!-- Nav-card: Supervisor Set Day Status (NCCPD) -->
        <a href="{{ url_for('day_status') }}" class="nav-card no-underline">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="nav-card__title text-lg mb-1">
                Set Day Status (NCCPD)
              </h3>
              <p class="nav-card__meta muted">
                Supervisors can set per-day status for officers (future 30
                days).
              </p>
            </div>
            <span class="emoji" aria-hidden="true">üìù</span>
          </div>
        </a>
        {% endif %}
      </div>

      <!-- Logout action at bottom of dashboard -->
      <!-- Logout button -->
      <div class="mt-10 text-center">
        <a href="{{ url_for('logout') }}" class="btn btn--danger">Logout</a>
      </div>
    </div>
    <!-- End of landing.html -->
  </body>
</html>
