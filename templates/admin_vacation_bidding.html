<!DOCTYPE html>
<html lang="en">
  <!--
    Template: admin_vacation_bidding.html
    Purpose: Admin tool to open/close vacation bidding per officer in strict seniority order.
    Brand colors: yellow gradient actions, indigo headers, neutral cards, dark mode support.
  -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Vacation Bidding — Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  </head>

  <body class="theme-dark min-h-screen">
    <div class="max-w-6xl mx-auto px-4 py-8 animate-fade-in">
      {% include '_toasts.html' %}

      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <a href="{{ url_for('landing') }}" class="text-white hover:underline">&larr; Back</a>

        <h1 class="text-3xl font-bold text-white">
          Vacation Bidding
        </h1>

        <div class="w-20"></div>
      </div>

      <!-- Filter + status -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6 flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between">
        <form method="GET" action="{{ url_for('vacation_bidding') }}" class="flex items-center gap-3">
          <label for="squad" class="text-sm text-gray-600 dark:text-gray-300">Squad:</label>
          <select id="squad" name="squad"
                  class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 dark:bg-gray-700 dark:text-gray-100"
                  onchange="this.form.submit()">
            {% for s in squads %}
              <option value="{{ s }}" {% if selected_squad==s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
        </form>

        <div class="text-sm text-gray-600 dark:text-gray-300">
          Windows open: <strong>{{ total_open }}</strong>
          &middot; Squad <strong>{{ selected_squad }}</strong>
          &middot; Officers: <strong>{{ officers|length }}</strong>
        </div>
      </div>

      <!-- Officers grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        {% for o in officers %}
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg transition-transform transform hover:scale-[1.01] p-6 flex flex-col gap-4">
          <!-- Name + rank -->
          <div class="flex items-start justify-between gap-3">
            <div>
              <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">
                {{ o.last_name }}, {{ o.first_name }}
              </h3>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                {{ o.rank or 'Officer' }} &middot; {{ o.call_sign or '—' }}
              </p>
            </div>

            <!-- Status pill -->
            {% if o.bidding_open %}
              <span class="px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                Open
              </span>
            {% else %}
              <span class="px-2 py-1 rounded-full text-xs font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                Closed
              </span>
            {% endif %}
          </div>

          <!-- Seniority -->
          <div class="text-sm text-gray-600 dark:text-gray-300">
            Seniority: <strong>{{ o.seniority_date or '—' }}</strong>
          </div>

          <!-- Actions -->
          <div class="mt-2 flex items-center gap-2">
            {% if not o.bidding_open %}
              <form method="POST" action="{{ url_for('toggle_bidding') }}" onsubmit="return confirmOpen('{{ o.last_name }}');">
                <input type="hidden" name="_csrf" value="{{ csrf_token() }}">
                <input type="hidden" name="username" value="{{ o.username }}" />
                <input type="hidden" name="action" value="open" />
                <input type="hidden" name="squad" value="{{ selected_squad }}" />
                <button type="submit"
                        class="px-3 py-2 rounded-md bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-gray-900 font-semibold text-sm shadow-md transition">
                  Open Bidding
                </button>
              </form>
            {% else %}
              <form method="POST" action="{{ url_for('toggle_bidding') }}" onsubmit="return confirmClose('{{ o.last_name }}');">
                <input type="hidden" name="_csrf" value="{{ csrf_token() }}">
                <input type="hidden" name="username" value="{{ o.username }}" />
                <input type="hidden" name="action" value="close" />
                <input type="hidden" name="squad" value="{{ selected_squad }}" />
                <button type="submit"
                        class="px-3 py-2 rounded-md bg-gradient-to-r from-yellow-200 to-yellow-300 hover:from-yellow-300 hover:to-yellow-400 text-gray-900 font-semibold text-sm shadow-md transition">
                  Close Bidding
                </button>
              </form>
            {% endif %}
          </div>
        </div>
        {% endfor %}

        {% if officers|length == 0 %}
        <div class="col-span-full text-center text-gray-500 dark:text-gray-400">
          No officers found for this squad.
        </div>
        {% endif %}
      </div>

      <p class="mt-8 text-xs text-gray-500 dark:text-gray-400">
        Seniority order uses <code>seniority_date</code> (earlier date = more senior).  
        Actions are logged into each user’s <code>audit</code> list.
      </p>
    </div>

    <!-- Native confirms -->
    <script>
      function confirmOpen(lastName) {
        return confirm(`Open bidding window for ${lastName}?`);
      }
      function confirmClose(lastName) {
        return confirm(`Close bidding window for ${lastName}?`);
      }
    </script>
  </body>
</html>
