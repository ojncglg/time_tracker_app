<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ month_name }} {{ year }} — Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <style>
      /* Responsive square cells */
      .cell {
        position: relative;
      }
      .cell::before {
        content: "";
        display: block;
        padding-top: 100%;
      }
      .cell > * {
        position: absolute;
        inset: 0;
      }

      /* Subtle hover hint for the CTA */
      .viewhint {
        opacity: 0;
        transition: opacity 0.15s ease;
      }
      a.group:hover .viewhint {
        opacity: 1;
      }

      /* Optional: tiny fade-in for the whole page */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.45s ease-out both;
      }
    </style>
  </head>

  <body class="theme-dark min-h-screen">
    <div
      class="max-w-6xl mx-auto p-4 md:p-6 calendar-container animate-fade-in"
    >
      <!-- Header / Nav -->
      <div class="flex items-center justify-between mb-6">
        <a href="{{ url_for('landing') }}" class="text-sm underline"
          >← Back to Dashboard</a
        >

        <div class="flex items-center gap-2">
          <a
            href="{{ url_for('calendar_view', year=prev_year, month=prev_month) }}"
            class="btn"
            >‹ Prev</a
          >
          <div class="text-xl font-semibold">{{ month_name }} {{ year }}</div>
          <a
            href="{{ url_for('calendar_view', year=next_year, month=next_month) }}"
            class="btn"
            >Next ›</a
          >
        </div>

        <a href="{{ url_for('calendar_view') }}" class="text-sm underline"
          >Today</a
        >
      </div>

      <!-- Weekday headers -->
      <div
        class="grid grid-cols-7 gap-2 text-center text-xs font-medium weekday-head mb-2"
      >
        <div>Sun</div>
        <div>Mon</div>
        <div>Tue</div>
        <div>Wed</div>
        <div>Thu</div>
        <div>Fri</div>
        <div>Sat</div>
      </div>

      <!-- (Optional) Legend -->
      <div class="flex items-center gap-2 mb-3 text-xs muted">
        <span class="badge badge--gold">Your squad</span>
        <span class="badge">Shifts set</span>
        <span class="badge badge--holiday">Holiday</span>
        <!-- If you add .badge--today in style.css, you can expose it here too:
        <span class="badge badge--today">Today</span>
        -->
      </div>

      <!-- Calendar grid -->
      <div class="grid grid-cols-7 gap-2">
        {% for cell in cells %} {% if not cell %}
        <!-- Leading/Trailing blanks -->
        <div class="cell">
          <div class="cal-empty rounded-xl"></div>
        </div>
        {% else %}
        <div class="cell">
          <a
            href="{{ url_for('view_day', date=cell.date, squad=(user_squad or 'All')) }}"
            class="group cal-card p-2 flex flex-col rounded-xl transition {% if cell.holiday_name %} cal-holiday {% endif %} {% if cell.is_user_squad %} cal-card--mine {% endif %} {% if cell.is_today and cell.is_user_squad %} cal-today cal-today-glow {% endif %}"
            aria-label="{{ month_name }} {{ cell.day }}, {{ year }}{% if cell.holiday_name %} — {{ cell.holiday_name }}{% endif %}"
          >
            <div class="flex items-center justify-between">
              <div class="text-sm font-semibold">{{ cell.day }}</div>

              <!-- Allow Holiday + Today to appear together -->
              <div class="flex items-center gap-1">
                {% if cell.holiday_name %}
                <span class="badge badge--holiday">Holiday</span>
                {% endif %} {% if cell.is_today and cell.is_user_squad %}
                <span class="badge badge--today">Today</span>
                {% elif cell.is_user_squad and not cell.holiday_name %}
                <span class="badge badge--gold">Your squad</span>
                {% endif %}
              </div>
            </div>

            {% if cell.holiday_name %}
            <div class="mt-2 text-[10px] uppercase tracking-wide">
              {{ cell.holiday_name }}
            </div>
            {% elif cell.is_user_squad and cell.user_shift_label %}
            <div class="mt-2 text-[10px] uppercase tracking-wide">
              {{ cell.user_shift_label }}
            </div>
            {% elif cell.shifts and cell.shifts != {} %}
            <div class="mt-2 text-[10px] uppercase tracking-wide muted">
              Shifts set
            </div>
            {% else %}
            <div class="mt-2 text-[10px] muted">No shift data</div>
            {% endif %}

            <div class="mt-auto text-[10px] muted viewhint">View day →</div>
          </a>
        </div>
        {% endif %} {% endfor %}
      </div>
    </div>
  </body>
</html>
