<!DOCTYPE html>
<html lang="en">
  <!--
    Template: admin_requests.html
    Purpose: Display pending time-off requests for administrators to review and act on.
    Access: Restricted to users with 'admin' or 'webmaster' roles via @require_role decorator.
  -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Requests</title>
    <!-- TODO: Link to a shared CSS file for consistent styling -->
  </head>

  <body>
    <!-- Main heading for the admin requests page -->
    <h2>Time-Off Requests</h2>

    <!-- Table of all pending requests -->
    <table border="1" cellspacing="0" cellpadding="4">
      <thead>
        <tr>
          <th>User ID</th>
          <th>Last Name</th>
          <th>Call Sign</th>
          <th>Sector</th>
          <th>Date</th>
          <th>Type</th>
          <th>Hours</th>
          <th>Note</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <!-- Loop through each request object passed in from the view -->
        {% for req in requests %}
        <tr>
          <!-- Unique identifier for the user who made the request -->
          <td>{{ req.user }}</td>

          <!-- Display the user's last name for readability -->
          <td>{{ users[req.user].last_name }}</td>

          <!-- Officer's radios call sign -->
          <td>{{ users[req.user].call_sign }}</td>

          <!-- Department sector (e.g., Patrol, Traffic) -->
          <td>{{ users[req.user].sector }}</td>

          <!-- Requested date of time-off -->
          <td>{{ req.date }}</td>

          <!-- Type of leave: 'vacation' or 'sick' -->
          <td>{{ req.type }}</td>

          <!-- Number of hours requested -->
          <td>{{ req.hours }}</td>

          <!-- Optional note provided by the user -->
          <td>{{ req.note }}</td>

          <!-- Current status: 'pending', 'approved', 'denied', or 'logged' -->
          <td>{{ req.status }}</td>

          <!-- Actions column: only pending vacation requests can be approved/denied -->
          <td>
            {% if req.type == "vacation" and req.status == "pending" %}
            <!-- Approve button submits a POST to /handle-request with action=approve -->
            <form
              action="/handle-request"
              method="POST"
              style="display: inline; margin-right: 4px"
            >
              <input type="hidden" name="user" value="{{ req.user }}" />
              <input type="hidden" name="date" value="{{ req.date }}" />
              <input type="hidden" name="action" value="approve" />
              <input type="submit" value="Approve" />
            </form>

            <!-- Deny button submits a POST to /handle-request with action=deny -->
            <form
              action="/handle-request"
              method="POST"
              style="display: inline"
            >
              <input type="hidden" name="user" value="{{ req.user }}" />
              <input type="hidden" name="date" value="{{ req.date }}" />
              <input type="hidden" name="action" value="deny" />
              <input type="submit" value="Deny" />
            </form>
            {% else %}
            <!-- No actions available for sick requests or already handled vacations -->
            No action {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Link back to user landing/dashboard page -->
    <br />
    <a href="/landing">&larr; Back to Dashboard</a>
  </body>
</html>
